import{_ as ne,a as ie}from"./ArchetypeDialog-DzghOjB7.js";import{C as ce,r,b as n,w as c,j as o,m as x,F as ue,z as me,e as k,d as u,p as i,t as j,u as P,f as C,D as de,B as ve,E as pe,i as g,A as fe}from"./app-CNC4IMbH.js";import{a as v}from"./api-DLStZGrk.js";import"./loading-CNBH5LN6.js";const ye={key:0,class:"item-header"},he={class:"d-flex align-center justify-center fill-height bg-grey-lighten-2"},ge={class:"text-h6"},_e={class:"text-h6"},be={key:3,class:"mt-4"},ke={key:0,class:"mb-4"},we={class:"text-h5 font-weight-bold"},xe={key:2,class:"mb-4"},Ee={__name:"ItemDialog",props:{item:{type:Object,default:null},archetype:{type:Object,default:null},aim:{type:String,required:!0}},emits:["stored","updated"],setup(s,{emit:T}){const p=pe(!1),L=ve().props.auth.user,a=g(null),S=g([]),I=g([]),w=g({}),f=g(!1),y=g(""),A=g(!1),_=s,O=T;ce(p,t=>{t?U():G()});const $=async()=>{const t=await v.get(route("items.show",_.item.id));a.value=t.data.data,await M()},M=async()=>{f.value=!1;try{const t=await v.get(route("item.is-rented",a.value.id));f.value=t.data.data===!0}catch(t){console.error("Error checking rental status:",t),f.value=!1}},q=()=>{var t;(_.aim=="edit"||_.aim=="view")&&_.item?$():a.value={archetype:_.archetype??null,created_at:((t=_.item)==null?void 0:t.created_at)||new Date().toISOString()}},U=async()=>{q(),I.value=[],B()},G=()=>{f.value=!1,y.value=""},H=async()=>{var t,e;w.value={};try{const l=await v.post(route("items.store"),a.value);if(l!=null&&l.success&&l.data.id){a.value=l.data;for(const d of I.value)await v.post(route("item-images.store",a.value.id),d);O("stored"),p.value=!1}}catch(l){(e=(t=l.response)==null?void 0:t.data)!=null&&e.errors&&(w.value=l.response.data.errors)}},J=async()=>{var t,e;w.value={};try{const l=await v.put(route("items.update"),a.value);if(l!=null&&l.success){for(const d of I.value)await v.post(route("item-images.store",a.value.id),d);O("updated"),p.value=!1}}catch(l){(e=(t=l.response)==null?void 0:t.data)!=null&&e.errors&&(w.value=l.response.data.errors)}},K=async()=>{var t,e,l,d;A.value=!0,y.value="";try{await v.post(route("rentals.store"),{item:a.value}),p.value=!1,fe.visit("/my-rentals")}catch(h){console.error("Error creating rental:",h),(e=(t=h.response)==null?void 0:t.data)!=null&&e.message?y.value=h.response.data.message:(d=(l=h.response)==null?void 0:l.data)!=null&&d.errors?y.value=Object.values(h.response.data.errors).flat().join(", "):y.value="Failed to create rental. Please try again."}finally{A.value=!1}},B=async t=>{if(t){const e=await v.get(route("archetypes.index"),{params:{query:t}});S.value=e.data.data}},Q=ne.debounce(B,300),W=t=>{const e=t.target.files;e.length&&I.value.push(...Array.from(e))};return(t,e)=>{const l=r("v-btn"),d=r("v-progress-circular"),h=r("v-carousel-item"),X=r("v-carousel"),z=r("v-card-title"),Y=r("v-autocomplete"),Z=r("v-checkbox"),D=r("v-divider"),F=r("v-card"),E=r("v-alert"),ee=r("v-icon"),ae=r("v-chip"),te=r("v-file-input"),le=r("v-card-text"),se=r("v-spacer"),oe=r("v-card-actions"),re=r("v-dialog");return o(),n(re,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=b=>p.value=b),"max-width":"700",onOpen:U},{activator:c(({props:b})=>[u(l,de({color:s.aim==="edit"||s.aim==="view"?"primary":"success","prepend-icon":s.aim==="edit"?"mdi-pencil":s.aim==="view"?"mdi-cart":"mdi-plus",text:s.aim==="edit"?"Edit Item":s.aim==="view"?"Rent Item":"Create Item",variant:"tonal",block:""},b,{size:"small"}),null,16,["color","prepend-icon","text"])]),default:c(()=>[a.value?(o(),n(F,{key:0},{default:c(()=>{var b,N;return[(b=a.value.images)!=null&&b.length||s.aim!=="view"?(o(),x("div",ye,[(N=a.value.images)!=null&&N.length?(o(),n(X,{key:0,"hide-delimiters":"",height:"280","show-arrows":"hover"},{placeholder:c(()=>[k("div",he,[u(d,{indeterminate:"",color:"grey-lighten-1"})])]),default:c(()=>[(o(!0),x(ue,null,me(a.value.images,(m,V)=>(o(),n(h,{key:V,src:m.url,cover:""},null,8,["src"]))),128))]),_:1})):i("",!0),u(z,{class:"d-flex align-center justify-space-between pb-4"},{default:c(()=>{var m;return[k("span",ge,j(s.aim==="view"?(m=a.value.archetype)==null?void 0:m.name:s.aim==="edit"?"Edit Item":"Create Item"),1)]}),_:1})])):(o(),n(z,{key:1,class:"d-flex align-center justify-space-between"},{default:c(()=>{var m;return[k("span",_e,j(s.aim==="view"?(m=a.value.archetype)==null?void 0:m.name:s.aim==="edit"?"Edit Item":"Create Item"),1)]}),_:1})),u(le,{class:"pt-2"},{default:c(()=>{var m,V;return[s.aim!=="view"?(o(),n(Y,{key:0,modelValue:a.value.archetype,"onUpdate:modelValue":e[0]||(e[0]=R=>a.value.archetype=R),items:S.value,label:"Archetype","item-title":"name","item-value":"id","hide-no-data":"","return-object":!0,readonly:s.aim==="view","error-messages":w.value["archetype.id"],"onUpdate:search":P(Q)},null,8,["modelValue","items","readonly","error-messages","onUpdate:search"])):i("",!0),s.aim!=="view"&&((m=a.value.archetype)==null?void 0:m.created_by)===P(L).id?(o(),n(ie,{key:1,aim:"edit",archetype:a.value.archetype,class:"mb-2"},null,8,["archetype"])):i("",!0),s.aim==="edit"?(o(),n(Z,{key:2,modelValue:a.value.make_item_unavailable,"onUpdate:modelValue":e[1]||(e[1]=R=>a.value.make_item_unavailable=R),label:"Make item unavailable","true-value":1,"false-value":0,class:"mb-2"},null,8,["modelValue"])):i("",!0),s.aim==="view"?(o(),x("div",be,[u(D,{class:"mb-4"}),(V=a.value.access_value)!=null&&V.current_daily_rate?(o(),x("div",ke,[u(F,{variant:"tonal",color:"info",class:"pa-3"},{default:c(()=>[e[5]||(e[5]=k("div",{class:"text-subtitle-2 mb-1"},"Rental Cost",-1)),k("div",we,[C(j(a.value.access_value.current_daily_rate)+" ",1),e[4]||(e[4]=k("span",{class:"text-body-2"},"credits / day",-1))])]),_:1})])):i("",!0),a.value.make_item_unavailable?(o(),n(E,{key:1,color:"warning",variant:"tonal",class:"mb-4",density:"compact"},{default:c(()=>[...e[6]||(e[6]=[C(" This item is currently marked as unavailable ",-1)])]),_:1})):i("",!0),!a.value.make_item_unavailable&&!f.value?(o(),x("div",xe,[u(ae,{color:"success",variant:"flat"},{default:c(()=>[u(ee,{start:"",icon:"mdi-check"}),e[7]||(e[7]=C(" Available ",-1))]),_:1})])):i("",!0),f.value?(o(),n(E,{key:3,color:"error",variant:"tonal",class:"mb-4",density:"compact"},{default:c(()=>[...e[8]||(e[8]=[C(" This item is currently rented ",-1)])]),_:1})):i("",!0),y.value?(o(),n(E,{key:4,color:"error",variant:"tonal",class:"mb-4",density:"compact"},{default:c(()=>[C(j(y.value),1)]),_:1})):i("",!0)])):i("",!0),s.aim!=="view"?(o(),n(te,{key:4,label:"Upload Image","prepend-icon":"mdi-camera",accept:"image/*",multiple:"","show-size":"",class:"mt-4",onChange:W})):i("",!0)]}),_:1}),u(D),u(oe,null,{default:c(()=>[u(se),u(l,{text:"Cancel",variant:"plain",onClick:e[2]||(e[2]=m=>p.value=!1)}),s.aim==="edit"?(o(),n(l,{key:0,color:"success",text:"Save",variant:"tonal",onClick:J})):i("",!0),s.aim==="create"?(o(),n(l,{key:1,color:"success",text:"Create",variant:"tonal",onClick:H})):i("",!0),s.aim==="view"&&!f.value&&!a.value.make_item_unavailable?(o(),n(l,{key:2,color:"success",text:"Confirm Rental",variant:"tonal",loading:A.value,onClick:K},null,8,["loading"])):i("",!0)]),_:1})]}),_:1})):i("",!0)]),_:1},8,["modelValue"])}}};export{Ee as default};

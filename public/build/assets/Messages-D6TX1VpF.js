import{o as Z,r,b as v,w as o,d as l,u as b,h as ee,e as n,j as a,p as m,m as d,F as V,z as U,n as C,f as p,t as u,H as te,B as se,a as B,x as ae,i as g,I as A,A as oe}from"./app-Cl7cSYny.js";import{P as ne}from"./PageLayout-D-q0Jw-F.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./loading-B-pAuaq2.js";import"./response-BrJijees.js";const le={class:"d-flex justify-space-between align-center mb-4"},ie={class:"text-white"},de={key:0,class:"text-blue"},ce={class:"d-flex flex-column align-end"},ue={key:0},_e={key:1,class:"text-center mt-8"},me={class:"d-flex align-center pa-4 border-b"},ve={class:"text-white"},pe={class:"text-h6"},ge={key:0,class:"text-grey"},ye={class:"messages-container flex-grow-1 overflow-y-auto pa-4",style:{"max-height":"calc(100% - 120px)"}},fe={key:0,class:"text-center"},he={key:1},xe={key:0,class:"text-caption font-weight-bold mb-1"},be={class:"pa-4 border-t"},we={key:1,class:"d-flex align-center justify-center fill-height"},ke={class:"text-center"},Ce={__name:"Messages",setup(De){const I=se(),w=I.props.auth.user,y=g([]),_=g(null),D=g([]),f=g(""),S=g(!1),M=g(!1),h=g({}),F=async()=>{try{const t=await B.get(route("messages.conversations"));y.value=t.data.data,y.value.forEach(i=>{h.value[i.id]=i.unread_count||0});const c=(I.props.queryParams||{}).conversation;if(c){const i=y.value.find(T=>T.id===parseInt(c));i&&P(i)}}catch(t){console.error("Error fetching conversations:",t)}},P=async t=>{_.value=t,await H(t.id),h.value[t.id]=0},H=async t=>{S.value=!0;try{const e=await B.get(route("messages.conversations.show",{conversationId:t}));D.value=e.data.messages,await A(),N(),oe.reload({only:["notifications"]})}catch(e){console.error("Error fetching messages:",e)}finally{S.value=!1}},E=async()=>{if(!(!f.value.trim()||!_.value)){M.value=!0;try{const t=await B.post(route("messages.conversations.store",{conversationId:_.value.id}),{body:f.value});D.value.push(t.data.data),f.value="",await A(),N()}catch(t){console.error("Error sending message:",t)}finally{M.value=!1}}},N=()=>{const t=document.querySelector(".messages-container");t&&(t.scrollTop=t.scrollHeight)},K=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),R=t=>{const e=new Date(t),c=new Date,i=new Date(c);return i.setDate(i.getDate()-1),e.toDateString()===c.toDateString()?"Today":e.toDateString()===i.toDateString()?"Yesterday":e.toLocaleDateString()},k=t=>{var e,c;return t.rental?((e=t.rental.item)==null?void 0:e.name)||"Rental Chat":((c=t.other_participant)==null?void 0:c.name)||"Chat"},j=ae(()=>Object.values(h.value).reduce((t,e)=>t+e,0));return Z(()=>{F()}),(t,e)=>{const c=r("v-badge"),i=r("v-avatar"),T=r("v-list-item-title"),W=r("v-list-item-subtitle"),O=r("v-list-item"),Y=r("v-list"),z=r("v-icon"),q=r("v-col"),$=r("v-progress-circular"),G=r("v-chip"),J=r("v-text-field"),Q=r("v-row"),X=r("v-container");return a(),v(ne,null,{default:o(()=>[l(b(ee),{title:"Messages"}),l(X,{fluid:"",class:"pa-4",style:{height:"calc(100vh - 100px)"}},{default:o(()=>[l(Q,{class:"fill-height"},{default:o(()=>[l(q,{cols:"12",md:"4",class:"border-e"},{default:o(()=>[n("div",le,[e[1]||(e[1]=n("div",{class:"text-h5 font-weight-bold"},"Messages",-1)),j.value>0?(a(),v(c,{key:0,content:j.value,color:"error"},null,8,["content"])):m("",!0)]),y.value.length?(a(),v(Y,{key:0,lines:"two"},{default:o(()=>[(a(!0),d(V,null,U(y.value,s=>{var x,L;return a(),v(O,{key:s.id,active:((x=_.value)==null?void 0:x.id)===s.id,class:C(["mb-2 rounded",{"bg-blue-lighten-5":((L=_.value)==null?void 0:L.id)===s.id}]),onClick:Se=>P(s)},{prepend:o(()=>[l(i,{color:"primary",size:"40"},{default:o(()=>[n("span",ie,u(k(s).charAt(0).toUpperCase()),1)]),_:2},1024)]),append:o(()=>[n("div",ce,[s.latest_message?(a(),d("small",ue,u(R(s.latest_message.created_at)),1)):m("",!0),h.value[s.id]>0?(a(),v(c,{key:1,content:h.value[s.id],color:"error",inline:""},null,8,["content"])):m("",!0)])]),default:o(()=>[l(T,{class:"font-weight-bold"},{default:o(()=>[p(u(k(s)),1)]),_:2},1024),s.latest_message?(a(),v(W,{key:0},{default:o(()=>[s.latest_message.is_system_message?(a(),d("span",de," ðŸ“¢ System ")):m("",!0),p(" "+u(s.latest_message.body.substring(0,40))+u(s.latest_message.body.length>40?"...":""),1)]),_:2},1024)):m("",!0)]),_:2},1032,["active","class","onClick"])}),128))]),_:1})):(a(),d("div",_e,[l(z,{size:"64",color:"grey"},{default:o(()=>[...e[2]||(e[2]=[p("mdi-message-text-outline",-1)])]),_:1}),e[3]||(e[3]=n("div",{class:"text-h6 mt-2"},"No conversations yet",-1)),e[4]||(e[4]=n("div",{class:"text-body-2 text-grey"},"Rent a tool to start chatting!",-1))]))]),_:1}),l(q,{cols:"12",md:"8",class:"d-flex flex-column"},{default:o(()=>[_.value?(a(),d(V,{key:0},[n("div",me,[l(i,{color:"primary",size:"40",class:"mr-3"},{default:o(()=>[n("span",ve,u(k(_.value).charAt(0).toUpperCase()),1)]),_:1}),n("div",null,[n("div",pe,u(k(_.value)),1),_.value.other_participant?(a(),d("small",ge,u(_.value.other_participant.email),1)):m("",!0)])]),n("div",ye,[S.value?(a(),d("div",fe,[l($,{indeterminate:"",color:"primary"})])):(a(),d("div",he,[(a(!0),d(V,null,U(D.value,s=>{var x;return a(),d("div",{key:s.id,class:C(["mb-4",s.user_id===b(w).id?"text-right":"text-left"])},[s.is_system_message?(a(),v(G,{key:0,color:"blue",size:"small",class:"mb-1"},{default:o(()=>[l(z,{start:"",size:"small"},{default:o(()=>[...e[5]||(e[5]=[p("mdi-information",-1)])]),_:1}),e[6]||(e[6]=p(" System ",-1))]),_:1})):m("",!0),n("div",{class:C(["d-inline-block pa-3 rounded-lg",s.user_id===b(w).id?"bg-primary text-white":"bg-grey-lighten-3"]),style:{maxWidth:"80%",wordWrap:"break-word"}},[!s.is_system_message&&s.user_id!==b(w).id?(a(),d("div",xe,u((x=s.user)==null?void 0:x.name),1)):m("",!0),p(" "+u(s.body)+" ",1),n("div",{class:C(["text-caption mt-1",s.user_id===b(w).id?"text-white":"text-grey"])},u(K(s.created_at)),3)],2)],2)}),128))]))]),n("div",be,[l(J,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),placeholder:"Type a message...",variant:"outlined",density:"compact","hide-details":"","append-inner-icon":"mdi-send",disabled:M.value,"onClick:appendInner":E,onKeyup:te(E,["enter"])},null,8,["modelValue","disabled"])])],64)):(a(),d("div",we,[n("div",ke,[l(z,{size:"64",color:"grey"},{default:o(()=>[...e[7]||(e[7]=[p("mdi-message-text",-1)])]),_:1}),e[8]||(e[8]=n("div",{class:"text-h6 mt-2"},"Select a conversation",-1)),e[9]||(e[9]=n("div",{class:"text-body-2 text-grey"},"Choose a conversation from the list to start chatting",-1))])]))]),_:1})]),_:1})]),_:1})]),_:1})}}},Ie=re(Ce,[["__scopeId","data-v-81cd52d5"]]);export{Ie as default};

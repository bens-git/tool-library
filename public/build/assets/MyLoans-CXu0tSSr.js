import{a as y}from"./api-DuAdOD0e.js";import{o as Q,r as n,b as c,w as o,d as s,u as W,h as X,e as r,j as i,m as L,F as Y,z as Z,f as l,t as p,p as f,B as tt,i as d}from"./app-Cl7cSYny.js";import{P as et}from"./PageLayout-D-q0Jw-F.js";import"./loading-B-pAuaq2.js";import"./response-BrJijees.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ot={style:{width:"100%"}},st={class:"mb-2"},nt={class:"text-caption text-grey"},at={key:0,class:"mb-3 pa-2 bg-grey-lighten-4 rounded"},lt={class:"text-body-2"},it={class:"text-caption text-grey"},pt={__name:"MyLoans",setup(rt){const h=tt(),C=d([]),m=d(!1),g=d(null),z=d(1),B=d(10),P=d([]),V=d(0),N=h.props.auth.user,R=a=>({booked:"blue",active:"green",completed:"grey",cancelled:"red",holding:"orange"})[a]||"grey",D=a=>a?new Date(a).toLocaleDateString():"",k=async()=>{const a={page:z.value,itemsPerPage:B.value,sortBy:P.value,ownerId:N.id},t=await y.get(route("rentals.index"),{params:a});C.value=t.data,V.value=t.total},M=a=>{g.value=a,m.value=!0},$=async()=>{g.value!==null&&(await y.delete(route("rentals.destroy",g.value)),m.value=!1,g.value=null)},j=async a=>{try{await y.patch(route("rentals.update",a),{status:"completed"}),k()}catch(t){console.error(t)}},A=async a=>{try{await y.patch(route("rentals.update",a),{status:"holding"}),k()}catch(t){console.error(t)}};return Q(()=>{k()}),(a,t)=>{const F=n("v-list-item-title"),H=n("v-chip"),S=n("v-icon"),u=n("v-btn"),T=n("v-list-item-subtitle"),b=n("v-list-item"),q=n("v-list"),E=n("v-card-title"),I=n("v-card-text"),U=n("v-spacer"),G=n("v-card-actions"),J=n("v-card"),K=n("v-dialog"),O=n("v-container");return i(),c(et,{title:"My Loans"},{default:o(()=>[s(W(X),{title:"My Loans"}),s(O,{fluid:"",class:"d-flex align-center justify-center pa-4"},{default:o(()=>[r("div",ot,[t[13]||(t[13]=r("div",{class:"d-flex justify-space-between align-center mb-4"},[r("div",{class:"text-h5 font-weight-bold"},"My Loans")],-1)),s(q,{lines:"five"},{default:o(()=>{var _;return[(_=C.value)!=null&&_.length?(i(!0),L(Y,{key:0},Z(C.value,e=>(i(),c(b,{key:e.id},{default:o(()=>[s(F,{class:"text-h6 mb-1"},{default:o(()=>{var v,x,w;return[l(p(((v=e.item)==null?void 0:v.name)||((w=(x=e.item)==null?void 0:x.archetype)==null?void 0:w.name)||"Loading..."),1)]}),_:2},1024),s(T,null,{default:o(()=>[r("div",st,[s(H,{color:R(e.status),size:"small",class:"mr-2"},{default:o(()=>[l(p(e.status),1)]),_:2},1032,["color"]),r("span",nt," Rented: "+p(D(e.rented_at)),1)]),e.renter?(i(),L("div",at,[t[2]||(t[2]=r("div",{class:"text-caption font-weight-bold"},"Renter",-1)),r("div",lt,p(e.renter.name),1),r("div",it,p(e.renter.email),1)])):f("",!0),e.conversation_id&&(e.status==="booked"||e.status==="active"||e.status==="holding")?(i(),c(u,{key:1,color:"primary",size:"small",class:"mt-2 mr-2",href:"/messages?conversation="+e.conversation_id},{default:o(()=>[s(S,{start:"",size:"small"},{default:o(()=>[...t[3]||(t[3]=[l("mdi-message",-1)])]),_:1}),t[4]||(t[4]=l(" Contact Renter ",-1))]),_:1},8,["href"])):f("",!0),e.status==="active"?(i(),c(u,{key:2,color:"green",size:"small",class:"mt-2",onClick:v=>j(e.id)},{default:o(()=>[...t[5]||(t[5]=[l(" Confirm Returned ",-1)])]),_:1},8,["onClick"])):f("",!0),e.status==="booked"?(i(),c(u,{key:3,color:"orange",size:"small",class:"mt-2 ml-2",onClick:v=>A(e.id)},{default:o(()=>[...t[6]||(t[6]=[l(" Allow Holding ",-1)])]),_:1},8,["onClick"])):f("",!0),e.status==="booked"?(i(),c(u,{key:4,size:"small",class:"mt-2 ml-2",onClick:v=>M(e.id)},{default:o(()=>[...t[7]||(t[7]=[l(" Cancel Loan ",-1)])]),_:1},8,["onClick"])):f("",!0)]),_:2},1024)]),_:2},1024))),128)):(i(),c(b,{key:1},{default:o(()=>[...t[8]||(t[8]=[l("No loans found.",-1)])]),_:1}))]}),_:1}),s(K,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=_=>m.value=_),"max-width":"400px"},{default:o(()=>[s(J,null,{default:o(()=>[s(E,{class:"headline"},{default:o(()=>[...t[9]||(t[9]=[l("Confirm Cancellation",-1)])]),_:1}),s(I,null,{default:o(()=>[...t[10]||(t[10]=[l(" Are you sure you want to cancel this loan? ",-1)])]),_:1}),s(G,null,{default:o(()=>[s(U),s(u,{text:"",onClick:t[0]||(t[0]=_=>m.value=!1)},{default:o(()=>[...t[11]||(t[11]=[l("Cancel",-1)])]),_:1}),s(u,{color:"red",onClick:$},{default:o(()=>[...t[12]||(t[12]=[l("Confirm",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})}}};export{pt as default};

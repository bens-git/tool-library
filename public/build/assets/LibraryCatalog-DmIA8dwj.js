import{P as ne}from"./PageLayout-D-q0Jw-F.js";import{o as re,C as de,y as ce,r,b as m,w as d,d as n,u as a,h as ue,e as p,f as A,t as Z,j as s,p as v,m as b,F as ie,z as me,B as ve,i as c}from"./app-Cl7cSYny.js";import H from"./ItemDialog-zb4MNkFn.js";import pe from"./AvailabilityDialog-Zjq4llHG.js";import _e from"./DeleteItemDialog-BhGvtIte.js";import{_ as I}from"./ArchetypeDialog-DZXcJXDD.js";import{a as C}from"./api-DuAdOD0e.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./loading-B-pAuaq2.js";import"./response-BrJijees.js";const ye={style:{width:"100%"}},fe={class:"d-flex justify-space-between align-center mb-4"},he={key:0,class:"mb-2"},be={key:0},xe={class:"mt-6"},we={class:"d-flex flex-wrap ga-2",style:{width:"100%"}},Ve={key:1,class:"text-grey"},Ue={key:2,class:"text-grey"},ke={key:0,class:"mt-6 text-center"},Ae={__name:"LibraryCatalog",setup(Ie){const u=ve().props.auth.user,_=c([]),z=c(1),Q=c(9),y=c(!1),x=c(!0),N=c(null);let f=null;const o=c({archetype:null,category:null,usage:null,brand:null,search:null,user_id:null}),w=c(!1),q=()=>w.value=!w.value,W=c([]),E=c([]),$=c([]),F=c([]),V=I.debounce(()=>{z.value=1,_.value=[],x.value=!0,L()},300),L=async()=>{var e,S,g,B,j,P,U,M;if(y.value||!x.value)return;y.value=!0;const l={page:z.value,itemsPerPage:Q.value,brand_id:(e=o.value.brand)==null?void 0:e.id,archetype_id:(g=(S=o.value)==null?void 0:S.archetype)==null?void 0:g.id,usage_id:(j=(B=o.value)==null?void 0:B.usage)==null?void 0:j.id,category_id:(U=(P=o.value)==null?void 0:P.category)==null?void 0:U.id,search:(M=o.value)==null?void 0:M.search};o.value.user_id&&(l.user_id=o.value.user_id);try{const h=await C.get(route("items.index"),{params:l}),T=h.data.data||[],D=h.data.total||0;_.value=[..._.value,...T],x.value=_.value.length<D,z.value++}catch(h){console.error("Error loading items:",h)}finally{y.value=!1}},K=()=>{f&&f.disconnect(),f=new IntersectionObserver(l=>{l[0].isIntersecting&&!y.value&&x.value&&L()},{threshold:.1}),N.value&&f.observe(N.value)},G=async l=>{if(l){const e=await C.get(route("archetypes.index"),{params:{query:l}});W.value=e.data.data}},J=async l=>{const e=await C.get(route("brands.index"),{params:{query:l}});E.value=e.data.data},O=async l=>{const e=await C.get(route("categories.index"),{params:{query:l}});$.value=e.data.data},R=async l=>{const e=await C.get(route("usages.index"),{params:{query:l}});F.value=e.data.data},X=I.debounce(G,300),Y=I.debounce(J,300),ee=I.debounce(O,300),ae=I.debounce(R,300);return re(async()=>{L(),K(),G(),de(()=>w.value,async l=>{l&&(J(),O(),R())})}),ce(()=>{f&&f.disconnect()}),(l,e)=>{const S=r("v-btn"),g=r("v-autocomplete"),B=r("v-checkbox"),j=r("v-expand-transition"),P=r("v-img"),U=r("v-icon"),M=r("v-card-title"),h=r("v-card-subtitle"),T=r("v-card-actions"),D=r("v-card"),te=r("v-col"),oe=r("v-row"),le=r("v-progress-circular"),se=r("v-container");return s(),m(ne,null,{default:d(()=>[n(a(ue),{title:"Catalog"}),n(se,{fluid:"",class:"d-flex align-center justify-center pa-4"},{default:d(()=>[p("div",ye,[p("div",fe,[e[5]||(e[5]=p("div",{class:"text-h5 font-weight-bold"},"Tools",-1)),p("div",null,[n(S,{size:"small",variant:"outlined",onClick:q},{default:d(()=>[A(Z(w.value?"Hide Advanced":"Advanced Search"),1)]),_:1}),a(u)?(s(),m(H,{key:0,aim:"create",class:"ml-2"})):v("",!0)])]),n(g,{modelValue:o.value.archetype,"onUpdate:modelValue":[e[0]||(e[0]=t=>o.value.archetype=t),a(V)],density:"compact",items:W.value,label:"Search","item-title":"name","item-value":"id","hide-no-data":"","hide-details":"","return-object":"",clearable:"","onUpdate:search":a(X)},null,8,["modelValue","items","onUpdate:modelValue","onUpdate:search"]),n(j,null,{default:d(()=>{var t;return[w.value?(s(),b("div",he,[a(u)?(s(),b("div",be,[n(B,{modelValue:o.value.user_id,"onUpdate:modelValue":[e[1]||(e[1]=i=>o.value.user_id=i),a(V)],"true-value":(t=a(u))==null?void 0:t.id,"false-value":null,label:"Show only my tools","hide-details":"",density:"compact"},null,8,["modelValue","true-value","onUpdate:modelValue"])])):v("",!0),n(g,{modelValue:o.value.brand,"onUpdate:modelValue":[e[2]||(e[2]=i=>o.value.brand=i),a(V)],density:"compact",items:E.value,label:"Brand","item-title":"name","item-value":"id","hide-no-data":"","hide-details":"","return-object":"",clearable:"","onUpdate:search":a(Y)},null,8,["modelValue","items","onUpdate:modelValue","onUpdate:search"]),n(g,{modelValue:o.value.category,"onUpdate:modelValue":[e[3]||(e[3]=i=>o.value.category=i),a(V)],density:"compact",items:$.value,label:"Category","item-title":"name","item-value":"id","hide-no-data":"","hide-details":"","return-object":"",clearable:"","onUpdate:search":a(ee)},null,8,["modelValue","items","onUpdate:modelValue","onUpdate:search"]),n(g,{modelValue:o.value.usage,"onUpdate:modelValue":[e[4]||(e[4]=i=>o.value.usage=i),a(V)],density:"compact",items:F.value,label:"Usage","item-title":"name","item-value":"id","hide-no-data":"","hide-details":"","return-object":"",clearable:"","onUpdate:search":a(ae)},null,8,["modelValue","items","onUpdate:modelValue","onUpdate:search"])])):v("",!0)]}),_:1}),p("div",xe,[n(oe,null,{default:d(()=>[(s(!0),b(ie,null,me(_.value,t=>(s(),m(te,{key:t.id,cols:"12",sm:"6",md:"4"},{default:d(()=>[n(D,{class:"pa-2",elevation:"2"},{default:d(()=>{var i;return[(i=t.images)!=null&&i.length?(s(),m(P,{key:0,src:t.images[0].url,height:"180",cover:"","lazy-src":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZTIeMmUyIi8+PC9zdmc+"},null,8,["src"])):(s(),m(U,{key:1,size:"80",class:"ma-4"},{default:d(()=>[...e[6]||(e[6]=[A("mdi-image-off",-1)])]),_:1})),n(M,{class:"text-subtitle-1"},{default:d(()=>{var k;return[A(Z((k=t.archetype)==null?void 0:k.name),1)]}),_:2},1024),n(h,null,{default:d(()=>{var k;return[A(Z((k=t.brand)==null?void 0:k.name),1)]}),_:2},1024),n(T,{class:"flex-wrap"},{default:d(()=>[p("div",we,[a(u)&&t.owned_by===a(u).id?(s(),m(pe,{key:0,item:t},null,8,["item"])):v("",!0),a(u)&&t.owned_by===a(u).id?(s(),m(H,{key:1,item:t,aim:"edit"},null,8,["item"])):v("",!0),!a(u)||t.owned_by!==a(u).id?(s(),m(H,{key:2,item:t,aim:"view"},null,8,["item"])):v("",!0),a(u)&&t.owned_by===a(u).id?(s(),m(_e,{key:3,item:t},null,8,["item"])):v("",!0)])]),_:2},1024)]}),_:2},1024)]),_:2},1024))),128))]),_:1}),p("div",{ref_key:"loadTrigger",ref:N,class:"text-center pa-4"},[y.value?(s(),m(le,{key:0,indeterminate:"",color:"primary"})):x.value?(s(),b("p",Ve," Scroll for more... ")):_.value.length?(s(),b("p",Ue," No more tools ")):v("",!0)],512)]),!_.value.length&&!y.value?(s(),b("div",ke,[n(U,{size:"64",color:"grey"},{default:d(()=>[...e[7]||(e[7]=[A("mdi-magnify",-1)])]),_:1}),e[8]||(e[8]=p("div",{class:"text-h6 mt-2"},"No tools found",-1))])):v("",!0)])]),_:1})]),_:1})}}},Ze=ge(Ae,[["__scopeId","data-v-e7b88168"]]);export{Ze as default};
